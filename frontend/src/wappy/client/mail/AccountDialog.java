package wappy.client.mail;//import com.google.gwt.user.client.Window;//import com.google.gwt.user.client.ui.DialogBox;import com.google.gwt.user.client.ui.HorizontalPanel;import com.google.gwt.user.client.ui.FlexTable;import com.google.gwt.user.client.ui.TextBox;import com.google.gwt.user.client.ui.PasswordTextBox;import com.google.gwt.user.client.ui.Button;import com.google.gwt.user.client.ui.HasHorizontalAlignment;import com.google.gwt.user.client.Command;import com.google.gwt.user.client.DeferredCommand;import com.google.gwt.event.dom.client.ClickHandler;import com.google.gwt.event.dom.client.ClickEvent;import com.extjs.gxt.ui.client.widget.Window;import com.extjs.gxt.ui.client.widget.layout.FitLayout;import com.google.gwt.http.client.RequestBuilder;import com.google.gwt.http.client.RequestCallback;import com.google.gwt.http.client.RequestException;import com.google.gwt.http.client.Request;import com.google.gwt.http.client.Response;import com.google.gwt.json.client.JSONParser;import com.google.gwt.json.client.JSONObject;import com.google.gwt.json.client.JSONString;import com.pathf.gwt.util.json.client.JSONWrapper;public class AccountDialog {    public static void show(final Command onAccountCreated) {        final Window window = new Window();        window.setSize(415, 275);        window.setPlain(true);        window.setHeading("Mail Account");        window.setLayout(new FitLayout());        final TextBox nameTextBox = new TextBox();        final TextBox serverAddressTextBox = new TextBox();        final TextBox serverPortTextBox = new TextBox();        final TextBox usernameTextBox = new TextBox();        final PasswordTextBox passwordTextBox = new PasswordTextBox();        Button saveButton;        Button cancelButton;        HorizontalPanel buttonPanel = new HorizontalPanel();        nameTextBox.setVisibleLength(40);        serverAddressTextBox.setVisibleLength(40);        serverPortTextBox.setVisibleLength(5);        usernameTextBox.setVisibleLength(40);        passwordTextBox.setVisibleLength(40);        saveButton = new Button("Save", new ClickHandler() {            public void onClick(ClickEvent event) {                JSONObject jsonRequest = new JSONObject();                jsonRequest.put("name",                    new JSONString(nameTextBox.getText()));                jsonRequest.put("server_address",                    new JSONString(serverAddressTextBox.getText()));                jsonRequest.put("server_port",                    new JSONString(serverPortTextBox.getText()));                jsonRequest.put("username",                    new JSONString(usernameTextBox.getText()));                jsonRequest.put("password",                    new JSONString(passwordTextBox.getText()));                RequestBuilder builder =                    new RequestBuilder(RequestBuilder.POST,                                       "/mail/accounts/create/");                try {                    builder.sendRequest(jsonRequest.toString(),                                        new RequestCallback() {                        public void onError(Request request,                                            Throwable exception) {                        }                        public void onResponseReceived(Request request,                                                       Response response) {                            if (response.getStatusCode() != 200) return;                            JSONWrapper root = new JSONWrapper(                                JSONParser.parse(response.getText()));                                                        if (root.get("error").isNull()) {                                // Success!                                com.google.gwt.user.client.Window.alert(                                    "Account created successfully!");                                window.hide();                                DeferredCommand.addCommand(onAccountCreated);                            }                            else {                                // Failure!                                com.google.gwt.user.client.Window.alert(                                    root.get("error").stringValue());                            }                        }                    });                }                catch (RequestException e) {                }            }        });        cancelButton = new Button("Cancel", new ClickHandler() {            public void onClick(ClickEvent event) {                window.hide();            }        });        buttonPanel.add(saveButton);        buttonPanel.add(cancelButton);        // Create a table to layout all widgets.        FlexTable layout = new FlexTable();        layout.setCellSpacing(6);        FlexTable.FlexCellFormatter cellFormatter =            layout.getFlexCellFormatter();        layout.setHTML(0, 0,            "Supply name and settings for the IMAP account to be added.");        cellFormatter.setColSpan(0, 0, 2);        cellFormatter.setHorizontalAlignment(0, 0,            HasHorizontalAlignment.ALIGN_CENTER);        layout.setHTML(1, 0, "Name:");        layout.setWidget(1, 1, nameTextBox);        layout.setHTML(2, 0, "Server address:");        layout.setWidget(2, 1, serverAddressTextBox);        layout.setHTML(3, 0, "Server port:");        layout.setWidget(3, 1, serverPortTextBox);        layout.setHTML(4, 0, "Username:");        layout.setWidget(4, 1, usernameTextBox);        layout.setHTML(5, 0, "Password:");        layout.setWidget(5, 1, passwordTextBox);        layout.setWidget(6, 0, buttonPanel);        cellFormatter.setColSpan(6, 0, 2);        cellFormatter.setHorizontalAlignment(6, 0,            HasHorizontalAlignment.ALIGN_CENTER);        window.add(layout);        window.show();                DeferredCommand.addCommand(new Command() {            public void execute() {                window.toFront();            }        });    }}